======================================================================================
                    SISTEMA DE RASPADINHA DIÃRIA - CLICK OFERTAS PARAGUAI
                           DocumentaÃ§Ã£o Completa das Funcionalidades
======================================================================================

ÃNDICE:
1. VISÃƒO GERAL DA ARQUITETURA
2. FUNCIONALIDADES PRINCIPAIS  
3. SISTEMA DE PROBABILIDADES E ALGORITMOS
4. FLUXO DE FUNCIONAMENTO
5. ESTRUTURA DE DADOS
6. CONFIGURAÃ‡Ã•ES AVANÃ‡ADAS
7. LOCALIZAÃ‡ÃƒO DO CÃ“DIGO

======================================================================================
1. VISÃƒO GERAL DA ARQUITETURA
======================================================================================

O sistema de raspadinha diÃ¡ria Ã© composto por:

FRONTEND (client/src/components/):
- ThreeDailyScratchCards.tsx: Componente principal que exibe 6 cards (3x2)
- scratch-card.tsx: Componente individual de raspadinha com efeitos
- BannerSection.tsx: IntegraÃ§Ã£o com banners rotativos

BACKEND (server/):
- routes.ts: Endpoints da API (/api/daily-scratch/*)
- storage.ts: MÃ©todos de acesso ao banco de dados
- services/intelligentScratchAlgorithm.ts: ALGORITMO DE PROBABILIDADES

BANCO DE DADOS (shared/schema.ts):
- dailyScratchCards: Cartas diÃ¡rias dos usuÃ¡rios
- dailyPrizes: PrÃªmios disponÃ­veis
- scratchSystemConfig: ConfiguraÃ§Ãµes de probabilidade
- algorithmSuggestions: SugestÃµes inteligentes de produtos

======================================================================================
2. FUNCIONALIDADES PRINCIPAIS
======================================================================================

A) SISTEMA DE 6 CARTAS DIÃRIAS:
-----------------------------
- Cada usuÃ¡rio recebe EXATAMENTE 6 cartas por dia (2 filas x 3 colunas)
- Cards sÃ£o criados automaticamente ao acessar a pÃ¡gina
- NÃ£o podem ser raspados duas vezes
- Reset automÃ¡tico Ã  meia-noite

LOCALIZAÃ‡ÃƒO: 
- client/src/components/ThreeDailyScratchCards.tsx (linhas 1-518)
- server/routes.ts (linha 2990: app.get('/api/daily-scratch/cards'))

B) EFEITO DE RASPAGEM REALISTA:
------------------------------
- Canvas HTML5 com imagem do mascote como fundo
- Efeito sonoro "xiado xiiii" (ruÃ­do branco filtrado 2-3kHz)
- Threshold de 70% para revelar o prÃªmio (linha 120 ThreeDailyScratchCards.tsx)
- Radius de 10px, step 10, delay 500ms para aumentar dificuldade

LOCALIZAÃ‡ÃƒO:
- client/src/components/scratch-card.tsx (linhas 1-1111)
- FunÃ§Ã£o measureRealProgress() (linha 94)

C) SISTEMA DE PRÃŠMIOS INTELIGENTE:
---------------------------------
- PrÃªmios categorizados: desconto_10, desconto_20, desconto_30, desconto_50, desconto_70, product, none
- Algoritmo inteligente seleciona produtos baseado em popularidade, preÃ§o, margem, novidade
- Probabilidades configurÃ¡veis via painel super admin

LOCALIZAÃ‡ÃƒO:
- server/services/intelligentScratchAlgorithm.ts (TODO O ARQUIVO)

D) PREVENÃ‡ÃƒO DE DUPLICATAS:
--------------------------
- Sistema anti-fraud impede mÃºltiplas raspagens
- Flags de controle: generatingCoupon, revelationStarted
- VerificaÃ§Ã£o de status no banco antes de permitir raspagem

LOCALIZAÃ‡ÃƒO:
- server/storage.ts (linha 2088-2131: funÃ§Ã£o getMyAvailablePromotions)

======================================================================================
3. SISTEMA DE PROBABILIDADES E ALGORITMOS
======================================================================================

*** ESTA Ã‰ A PARTE MAIS IMPORTANTE - ONDE ESTÃƒO AS PROBABILIDADES ***

A) ALGORITMO PRINCIPAL DE SELEÃ‡ÃƒO:
----------------------------------
ARQUIVO: server/services/intelligentScratchAlgorithm.ts

FUNÃ‡ÃƒO PRINCIPAL: generateProductSuggestions() (linha 52)
- Analisa TODOS os produtos ativos da plataforma
- Calcula 5 scores diferentes para cada produto:
  1. POPULARIDADE (linha 177): likes*3 + saves*2 + views*1
  2. PREÃ‡O (linha 216): faixas ideais R$20-100 = score 10
  3. MARGEM (linha 234): baseado na diferenÃ§a de preÃ§o vs custo
  4. NOVIDADE (linha 251): produtos mais recentes ganham pontos
  5. CATEGORIA (linha 268): certas categorias sÃ£o favorecidas

B) PESOS CONFIGURÃVEIS:
----------------------
ARQUIVO: shared/schema.ts (linha 1150: tabela scratchSystemConfig)

PESOS PADRÃƒO:
- popularityWeight: 0.30 (30%)
- priceWeight: 0.20 (20%)  
- marginWeight: 0.20 (20%)
- noveltyWeight: 0.15 (15%)
- categoryWeight: 0.15 (15%)

C) THRESHOLDS DE PRÃŠMIOS:
------------------------
ARQUIVO: server/services/intelligentScratchAlgorithm.ts (linha 82)

CONFIGURAÃ‡ÃƒO DE PRÃŠMIOS POR SCORE:
- Score >= 8.5: PRODUTO GRÃTIS (prÃªmio total)
- Score >= 8.0: DESCONTO 70%
- Score >= 7.0: DESCONTO 50%  
- Score >= 6.5: DESCONTO 30%
- Score >= 6.0: DESCONTO 20%
- Score < 6.0: SEM PRÃŠMIO

D) ALGORITMO DE PROBABILIDADE DE VITÃ“RIA:
----------------------------------------
ARQUIVO: server/storage.ts (linha 2822: funÃ§Ã£o scratchDailyScratchCard)

FÃ“RMULA DE PROBABILIDADE:
const winChance = 0.15; // 15% de chance base
if (Math.random() < winChance) {
    // USUÃRIO GANHA
} else {
    // USUÃRIO PERDE
}

*** ESTA Ã‰ A LINHA ONDE VOCÃŠ PODE ALTERAR A PROBABILIDADE DE GANHAR ***

E) SISTEMA DE GARANTIA DE VITÃ“RIA:
---------------------------------
ARQUIVO: shared/schema.ts (linha 1155)

CONFIGURAÃ‡ÃƒO: guaranteedWinEvery: "1000"
- A cada 1000 tentativas, sistema FORÃ‡A uma vitÃ³ria
- Contador global: currentAttemptCount
- Reseta automaticamente apÃ³s vitÃ³ria garantida

======================================================================================
4. FLUXO DE FUNCIONAMENTO
======================================================================================

PASSO 1: INICIALIZAÃ‡ÃƒO
---------------------
1. UsuÃ¡rio acessa a pÃ¡gina principal
2. Sistema verifica se existem 6 cartas para hoje
3. Se nÃ£o existem, cria automaticamente (ensureUserDailyScratchCards)
4. Exibe os 6 cards em layout 3x2

PASSO 2: RASPAGEM
----------------
1. UsuÃ¡rio clica e arrasta sobre o card
2. Canvas detecta movimento e "raspa" pixels (composite-operation: destination-out)
3. Sistema mede progresso real por transparÃªncia alpha
4. Aos 70% de progresso, inicia revelaÃ§Ã£o automÃ¡tica

PASSO 3: REVELAÃ‡ÃƒO
-----------------
1. Sistema consulta algoritmo inteligente
2. Calcula score do produto/prÃªmio
3. Aplica probabilidade de 15% de vitÃ³ria
4. Se ganhou: gera cupom e exibe modal
5. Se perdeu: exibe mensagem "NÃ£o foi dessa vez"

PASSO 4: PÃ“S-RASPAGEM
--------------------
1. Atualiza status da carta no banco (isScratched: true)
2. Registra tentativa diÃ¡ria
3. Invalida cache para atualizar interface
4. Card fica desabilitado atÃ© o prÃ³ximo dia

======================================================================================
5. ESTRUTURA DE DADOS
======================================================================================

TABELA: dailyScratchCards
------------------------
- id: Identificador Ãºnico da carta
- userId: ID do usuÃ¡rio proprietÃ¡rio
- cardNumber: NÃºmero da carta (1-6)
- dateCreated: Data de criaÃ§Ã£o (YYYY-MM-DD)
- isScratched: Se foi raspada (boolean)
- won: Se ganhou prÃªmio (boolean)
- prizeType: Tipo do prÃªmio (desconto_X, product, none)
- prizeValue: Valor do prÃªmio
- prizeDescription: DescriÃ§Ã£o textual
- couponCode: CÃ³digo do cupom gerado

TABELA: dailyPrizes
------------------
- id: ID do prÃªmio
- name: Nome do prÃªmio
- prizeType: Categoria (desconto_10, desconto_20, etc.)
- description: DescriÃ§Ã£o
- value: Valor monetÃ¡rio
- isActive: Se estÃ¡ ativo
- validFrom/validUntil: PerÃ­odo de validade

TABELA: scratchSystemConfig
--------------------------
- algorithmType: Tipo de algoritmo ("weighted_random")
- guaranteedWinEvery: Intervalo de vitÃ³ria garantida
- popularityWeight/priceWeight/etc: Pesos do algoritmo
- minPrizeValue/maxPrizeValue: Limites de valor dos prÃªmios

======================================================================================
6. CONFIGURAÃ‡Ã•ES AVANÃ‡ADAS
======================================================================================

A) ALTERANDO PROBABILIDADES:
---------------------------
Para alterar a chance de vitÃ³ria, edite o arquivo:
server/storage.ts, linha ~2822

ATUAL: const winChance = 0.15; // 15%
NOVO:  const winChance = 0.25; // 25% (exemplo)

B) ALTERANDO THRESHOLD DE RASPAGEM:
---------------------------------
Para tornar mais fÃ¡cil/difÃ­cil raspar, edite:
client/src/components/ThreeDailyScratchCards.tsx, linha 120

ATUAL: if (progress >= 0.7 && ...) // 70%
NOVO:  if (progress >= 0.5 && ...) // 50% (mais fÃ¡cil)

C) ALTERANDO NÃšMERO DE CARTAS:
-----------------------------
Para mudar de 6 para outro nÃºmero, edite:
server/storage.ts, funÃ§Ã£o ensureUserDailyScratchCards
Altere o loop que cria cartas de 1-6 para 1-X

D) CONFIGURANDO PESOS DO ALGORITMO:
---------------------------------
Via painel Super Admin em /super-admin
Ou diretamente no banco na tabela scratchSystemConfig

======================================================================================
7. LOCALIZAÃ‡ÃƒO DO CÃ“DIGO
======================================================================================

COMPONENTES PRINCIPAIS:
---------------------
ğŸ“ client/src/components/ThreeDailyScratchCards.tsx
   â”œâ”€â”€ Componente principal das 6 cartas
   â”œâ”€â”€ LÃ³gica de layout e exibiÃ§Ã£o
   â”œâ”€â”€ Controle de estado das cartas
   â””â”€â”€ IntegraÃ§Ã£o com API

ğŸ“ client/src/components/scratch-card.tsx  
   â”œâ”€â”€ Efeito de raspagem individual
   â”œâ”€â”€ Canvas HTML5 e manipulaÃ§Ã£o de pixels
   â”œâ”€â”€ Som "xiado xiiii" 
   â””â”€â”€ AnimaÃ§Ãµes e transiÃ§Ãµes

API ENDPOINTS:
-------------
ğŸ“ server/routes.ts
   â”œâ”€â”€ GET /api/daily-scratch/cards (linha 2990)
   â”œâ”€â”€ POST /api/daily-scratch/cards/:cardId/scratch (linha 3010)
   â”œâ”€â”€ GET /api/daily-scratch/stats (linha 3057)
   â””â”€â”€ POST /api/admin/daily-scratch/test (linha 2943)

ALGORITMO DE PROBABILIDADES:
---------------------------
ğŸ“ server/services/intelligentScratchAlgorithm.ts
   â”œâ”€â”€ *** FUNÃ‡ÃƒO PRINCIPAL: generateProductSuggestions() (linha 52) ***
   â”œâ”€â”€ *** SCORES: calculatePopularityScore() (linha 177) ***
   â”œâ”€â”€ *** PREÃ‡OS: calculatePriceScore() (linha 216) ***
   â”œâ”€â”€ *** MARGEM: calculateMarginScore() (linha 234) ***
   â”œâ”€â”€ *** NOVIDADE: calculateNoveltyScore() (linha 251) ***
   â””â”€â”€ *** CATEGORIA: calculateCategoryScore() (linha 268) ***

LÃ“GICA DE BANCO:
---------------
ğŸ“ server/storage.ts
   â”œâ”€â”€ *** PROBABILIDADE DE VITÃ“RIA: scratchDailyScratchCard() (~linha 2822) ***
   â”œâ”€â”€ ensureUserDailyScratchCards() - CriaÃ§Ã£o das 6 cartas
   â”œâ”€â”€ getDailyScratchCard() - Buscar carta especÃ­fica
   â””â”€â”€ getUserScratchCardsStats() - EstatÃ­sticas do usuÃ¡rio

CONFIGURAÃ‡Ã•ES:
-------------
ğŸ“ shared/schema.ts
   â”œâ”€â”€ *** TABELA: scratchSystemConfig (linha 1150) ***
   â”œâ”€â”€ TABELA: dailyScratchCards (linha 1095)
   â”œâ”€â”€ TABELA: dailyPrizes (linha 1124)
   â””â”€â”€ TABELA: algorithmSuggestions (linha 1234)

======================================================================================
                                   RESUMO EXECUTIVO
======================================================================================

O sistema de raspadinha diÃ¡ria Ã© uma gamificaÃ§Ã£o completa que:

âœ… Gera 6 cartas Ãºnicas por usuÃ¡rio por dia
âœ… Usa algoritmo inteligente para selecionar prÃªmios baseado em dados reais
âœ… Implementa probabilidade configurÃ¡vel de vitÃ³ria (padrÃ£o: 15%)
âœ… Garante vitÃ³ria apÃ³s X tentativas (padrÃ£o: 1000)
âœ… Oferece efeitos visuais e sonoros realistas
âœ… Previne fraudes e duplicaÃ§Ãµes
âœ… Integra com sistema de cupons e lojas
âœ… Fornece estatÃ­sticas detalhadas

*** PONTOS CRÃTICOS PARA AJUSTES ***:
- PROBABILIDADE DE VITÃ“RIA: server/storage.ts linha ~2822
- THRESHOLD DE RASPAGEM: ThreeDailyScratchCards.tsx linha 120  
- ALGORITMO DE SELEÃ‡ÃƒO: intelligentScratchAlgorithm.ts linha 52
- CONFIGURAÃ‡Ã•ES: Painel Super Admin /super-admin

======================================================================================
                                      FIM
======================================================================================